#!/usr/bin/env nu

# This script runs in the CURRENT pane (before floating pane opens)
# It detects if current pane is helix, saves to file, then opens floating pane

def main [] {
    # Get running command from list-clients - this shows the CURRENT pane's command
    let cmd = try {
        zellij action list-clients | lines | get 1 | split row " " | last
    } catch {
        ""
    }

    let mode = if ($cmd | str contains "hx") or ($cmd | str contains "helix") {
        "helix"
    } else {
        "shell"
    }

    # Save mode to temp file
    $mode | save -f /tmp/zellij-cd-mode

    # Now open the floating pane with fzf
    zellij run -c -f -x 10% -y 10% --width 80% --height 80% -- zellij-cd
}
