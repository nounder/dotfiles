#!/bin/sh

if [ -z "$ZELLIJ" ]; then
    echo "not in zellij. doing nothing"
    exit 0
fi

action="$1"

zellij run -c -f -x 10% -y 10% --width 80% --height 80% -- sh -c '
path=$(fzf --height=100% --preview-window=noborder --no-separator --preview "bat --color=always --wrap=never --style=plain {}")

zellij action toggle-floating-panes

if [ -n "$path" ]; then
    action="'"$action"'"
    if [ "$action" = "insert" ]; then
        # For shells: just insert the path as text
        zellij action write-chars "$path"
    else
        # For helix: send command like :open path
        bytes=$(printf ":$action $path\r:redraw\r" | od -An -tu1)
        zellij action write $bytes
    fi
fi
'
