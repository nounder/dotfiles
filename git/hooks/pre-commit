#!/bin/sh
# Warn if zig sources changed but binaries weren't rebuilt

for zig in bin/*.zig; do
  [ -f "$zig" ] || continue
  name="${zig%.zig}"
  name="${name#bin/}"

  # Skip if only chmod changed (no actual content diff lines starting with +/-)
  if git diff --cached --name-only --diff-filter=M | grep -q "^bin/$name.zig$" && \
     git diff --cached "bin/$name.zig" | grep -q '^[+-]'; then
    # Check if any binary for this program is also staged
    if ! git diff --cached --name-only | grep -q "^bin/$name-"; then
      echo "âš  bin/$name.zig changed but binaries not updated. Run ./build.sh"
      exit 1
    fi
  fi
done
